/**
 * Angular slide game - A simple angular slide game
 * @author Ayush Sharma
 * @version v0.0.1
 * @link 
 * @license MIT
 */
var app=angular.module("slideApp",["ngAnimate"]);app.service("gameModes",function(){this.modes={amateur:{row:4,column:4,elasped:36e5},semipro:{row:5,column:5,elasped:72e5},professional:{row:6,column:6,elasped:108e5},legendary:{row:8,column:8,elasped:144e5}},this.defaultMode=Object.keys(this.modes)[0],this.get=function(e){return e?this.modes[e]:this.modes[this.defaultMode]}}),app.controller("slideCtrl",["$scope","$interval","Game","gameModes","save",function(e,t,i,o,n){function s(){var t={model:e.game.grid,history:e.game.history,time:e.game.elasped,mode:e.game.mode};n.set(t)}var r,a,m=1e3;e.init=function(){var t=n.get();t?e.newGame(t.mode,t.model,t.history,t.time):e.newGame()},e.game={},e.game.history=[],e.game.modes=o.modes,e.newGame=function(n,u,d,l){var c=o.get(n);e.game.mode=n||o.defaultMode,e.game.history=d||[],e.game.elasped=l||c.elasped,r=new i(c.row,c.column),e.game.grid=u||r.newGame(),a&&t.cancel(a),a=t(function(){e.game.elasped-=m},m),s()},e.move=function(t,i){r.move(e.game.grid,t,i).then(function(t){e.game.grid=t.model,e.game.history.push(t)})},e.solve=function(){e.game.grid=r.solve()},e.$watch("game.grid",function(){_.isEqual(e.game.grid,r.solve())&&alert("You have solved the it")}),window.onbeforeunload=s}]),app.factory("Game",["$q",function(e){function t(e){var t=e.slice();return t.sort(function(){return.5-Math.random()}),t}function i(){var e=this.shuffleArray(this.elements);return this.makeModel(e)}function o(){return this.moves=0,this.makeModel(this.elements)}function n(e){var t,i,o={},n=this.x,s=this.y,r=0;for(i=0;i<n*s;i+=s)t=e.slice(),o[r]=t.splice(i,s),r+=1;return this.currentModel=o,o}function s(e,t){var i=_.reduce(e,function(e,i,o){var n=i.indexOf(t);return n>-1&&(e.x=parseInt(o,10),e.y=n),e},{});return i}function r(e,t){var i={};return e+1<this.x&&(i.down={x:e+1,y:t}),t+1<this.y&&(i.right={x:e,y:t+1}),e-1>=0&&(i.up={x:e-1,y:t}),t-1>=0&&(i.left={x:e,y:t-1}),i}function a(e,t,i){return _.reduce(e,function(e,o,n){return o.x==t&&o.y==i&&(e.status=!0,e.direaction=n,e.pos=o),e},{})}function m(t,i,o){var n,s=e.defer(),r=this.pivot(t,0),a=this.directions(r.x,r.y),m=this.checkMove(a,i,o);return m.status?(n=t[i][o],t[i][o]=t[r.x][r.y],t[r.x][r.y]=n,this.moves+=1,this.currentModel=t,s.resolve({model:t,"new":m,old:r,value:n})):s.reject("Can not move here"),s.promise}function u(e,u){this.x=e,this.y=u,this.elements=_.range(e*u),this.newGame=i,this.currentModel={},this.shuffleArray=t,this.makeModel=n,this.pivot=s,this.directions=r,this.move=m,this.checkMove=a,this.solve=o,this.moves=0}return u}]),app.service("save",function(){function e(e){localStorage.setItem(this.id,JSON.stringify(e))}function t(){return JSON.parse(localStorage.getItem(this.id))}this.id="slideGame",this.set=e,this.get=t});