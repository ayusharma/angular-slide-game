/**
 * Angular slide game - A simple angular slide game
 * @author Ayush Sharma
 * @version v0.0.1
 * @link 
 * @license MIT
 */
var app=angular.module("slideApp",["ngAnimate"]);app.service("gameModes",function(){this.modes={amateur:{row:4,column:4,elasped:36e5},semipro:{row:5,column:5,elasped:72e5},professional:{row:6,column:6,elasped:108e5},legendary:{row:8,column:8,elasped:144e5}},this.defaultMode=Object.keys(this.modes)[0],this.get=function(e){return e?this.modes[e]:this.modes[this.defaultMode]}}),app.controller("slideCtrl",["$scope","$interval","Game","gameModes","save",function(e,t,i,n,o){function r(){var t={model:e.game.grid,history:e.game.history,time:e.game.elasped,mode:e.game.mode};o.set(t)}var s,a,u=1e3;e.init=function(){var t=o.get();t?e.newGame(t.mode,t.model,t.history,t.time):e.newGame()},e.game={},e.game.history=[],e.game.modes=n.modes,e.newGame=function(o,m,c,l){var d=n.get(o);e.game.solved=!1,e.game.mode=o||n.defaultMode,e.game.history=c||[],e.game.elasped=l||d.elasped,s=new i(d.row,d.column),e.game.grid=m||s.newGame(),a&&t.cancel(a),a=t(function(){e.game.elasped-=u},u),r()},e.move=function(t,i){s.move(e.game.grid,t,i).then(function(t){e.game.grid=t.model,e.game.history.push(t)})},e.solve=function(){e.game.grid=s.solve()},e.$watch("game.grid",function(){_.isEqual(e.game.grid,s.solve())&&(e.game.solved=!0,o.remove(),t.cancel(a))}),window.onbeforeunload=r}]),app.factory("Game",["$q",function(e){function t(e){var t=e.slice();return t.sort(function(){return.5-Math.random()}),t}function i(){for(var e,t;;)if(e=this.shuffleArray(this.elements),this.isSolvable(e)){t=e;break}return this.makeModel(t)}function n(){var e=angular.copy(this.elements),t=e.shift();return e.push(t),this.moves=0,this.makeModel(e)}function o(e){var t,i,n={},o=this.x,r=this.y,s=0;for(i=0;i<o*r;i+=r)t=e.slice(),n[s]=t.splice(i,r),s+=1;return this.currentModel=n,n}function r(e,t){var i=_.reduce(e,function(e,i,n){var o=i.indexOf(t);return o>-1&&(e.x=parseInt(n,10),e.y=o),e},{});return i}function s(e,t){var i={};return e+1<this.x&&(i.down={x:e+1,y:t}),t+1<this.y&&(i.right={x:e,y:t+1}),e-1>=0&&(i.up={x:e-1,y:t}),t-1>=0&&(i.left={x:e,y:t-1}),i}function a(e,t,i){return _.reduce(e,function(e,n,o){return n.x==t&&n.y==i&&(e.status=!0,e.direaction=o,e.pos=n),e},{})}function u(t,i,n){var o,r=e.defer(),s=this.pivot(t,0),a=this.directions(s.x,s.y),u=this.checkMove(a,i,n);return u.status?(o=t[i][n],t[i][n]=t[s.x][s.y],t[s.x][s.y]=o,this.moves+=1,this.currentModel=t,r.resolve({model:t,"new":u,old:s,value:o})):r.reject("Can not move here"),r.promise}function m(e){var t=e.reduce(function(e,t,i,n){return n.slice(i).filter(function(e){return e<t}).map(function(e){return[t,e]}).concat(e)},[]).length;return t%2==0}function c(e,c){this.x=e,this.y=c,this.elements=_.range(e*c),this.newGame=i,this.currentModel={},this.shuffleArray=t,this.makeModel=o,this.pivot=r,this.directions=s,this.move=u,this.checkMove=a,this.solve=n,this.moves=0,this.isSolvable=m}return c}]),app.service("save",function(){function e(e){localStorage.setItem(this.id,JSON.stringify(e))}function t(){localStorage.removeItem(this.id)}function i(){return JSON.parse(localStorage.getItem(this.id))}this.id="slideGame",this.set=e,this.get=i,this.remove=t}),app.service("inversion",function(){});